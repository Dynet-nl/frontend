"use strict";(self.webpackChunkdynet=self.webpackChunkdynet||[]).push([[586],{1586:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var n=a(1413),s=a(2791),i=a(7689),o=a(4391),r=a(6965),l=a(9105),d=a(1896),m=(a(4225),a(184));const p=()=>{const{id:e}=(0,i.UO)(),t=((0,i.s0)(),(0,r.Z)()),[a,p]=(0,s.useState)(null),[c,u]=(0,s.useState)(!0),[h,v]=(0,s.useState)([]),[x,j]=(0,s.useState)([]),[N,y]=(0,s.useState)({date:"",startTime:"",endTime:"",weekNumber:null,type:"HAS",hasMonteurName:"",complaintDetails:""}),[k,f]=(0,s.useState)({}),b=e=>{const t=new Date(e),a=new Date(t.getFullYear(),0,1),n=Math.floor((t-a)/864e5);return Math.ceil(n/7)},M=e=>{if(!e)return"";return new Date(e).toISOString().split("T")[0]};(0,s.useEffect)((()=>{(async()=>{try{const{data:a}=await t.get("/api/building/".concat(e));p(a);const n={};a.flats.forEach((e=>{var t,a;null!==(t=e.hasMonteur)&&void 0!==t&&null!==(a=t.appointmentBooked)&&void 0!==a&&a.date&&(n[e._id]={date:M(e.hasMonteur.appointmentBooked.date),startTime:e.hasMonteur.appointmentBooked.startTime,endTime:e.hasMonteur.appointmentBooked.endTime,weekNumber:e.hasMonteur.appointmentBooked.weekNumber,type:e.hasMonteur.appointmentBooked.type||"HAS",hasMonteurName:e.hasMonteur.hasMonteurName||"",complaintDetails:e.hasMonteur.appointmentBooked.complaintDetails||""})})),f(n);const s=a.flats.filter((e=>{var t,a;return null===(t=e.hasMonteur)||void 0===t||null===(a=t.appointmentBooked)||void 0===a?void 0:a.date})).map((e=>e._id));v((e=>[...new Set([...e,...s])])),u(!1)}catch(a){o.Z.error("Error fetching building data",a),u(!1)}})(),(async()=>{try{const e=(await t.get("/api/users")).data.filter((e=>e.roles&&"object"===typeof e.roles&&2023===e.roles.HASMonteur));j(e)}catch(e){o.Z.error("Error fetching HAS Monteurs:",e)}})()}),[e,t]);const g=e=>{const{name:t,value:a}=e.target;y((e=>(0,n.Z)((0,n.Z)({},e),{},{[t]:a},"date"===t?{weekNumber:b(a)}:{})))};if(c)return(0,m.jsx)(d.Gu,{message:"Loading building data..."});const S=a.flats||[],D=(0,l.c)(a,S),T="".concat(a.address).concat(D?" (".concat(D,")"):"");return(0,m.jsxs)("div",{className:"ts-apartmentDetailsContainer",children:[(0,m.jsxs)("h2",{children:["HAS Appointment Schedule for ",T]}),(0,m.jsxs)("div",{className:"ts-columns",children:[(0,m.jsxs)("div",{className:"ts-leftColumn",children:[(0,m.jsx)("h3",{children:"Select Apartments for Appointment"}),a.flats.map((e=>(0,m.jsxs)("div",{className:"ts-apartmentDetails",children:[(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"checkbox",checked:h.includes(e._id),onChange:()=>{return t=e._id,void v((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t}}),e.adres," ",e.huisNummer,e.toevoeging]}),h.includes(e._id)&&k[e._id]&&(0,m.jsx)("div",{className:"appointmentDetails",children:(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"Current Appointment:"}),(0,m.jsxs)("div",{children:["Type: ",k[e._id].type]}),(0,m.jsxs)("div",{children:["Date: ",new Date(k[e._id].date).toLocaleDateString()]}),(0,m.jsxs)("div",{children:["Time: ",k[e._id].startTime," - ",k[e._id].endTime]}),(0,m.jsxs)("div",{children:["Week: ",k[e._id].weekNumber]}),k[e._id].hasMonteurName&&(0,m.jsxs)("div",{children:["HAS Monteur: ",k[e._id].hasMonteurName]}),"Complaint"===k[e._id].type&&k[e._id].complaintDetails&&(0,m.jsxs)("div",{children:["Complaint Details: ",k[e._id].complaintDetails]})]})})]},e._id)))]}),(0,m.jsxs)("div",{className:"ts-rightColumn",children:[(0,m.jsx)("h3",{children:"Set Appointment Details"}),(0,m.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),u(!0);try{const a=await Promise.all(h.map((async e=>{const a={appointmentBooked:{date:N.date,startTime:N.startTime,endTime:N.endTime,weekNumber:N.weekNumber,type:N.type},hasMonteurName:N.hasMonteurName};"Complaint"===N.type&&N.complaintDetails&&(a.appointmentBooked.complaintDetails=N.complaintDetails);return{flatId:e,data:(await t.put("/api/apartment/".concat(e,"/has-monteur"),a)).data}}))),s=(0,n.Z)({},k);a.forEach((e=>{var t;let{flatId:a,data:n}=e;null!==(t=n.hasMonteur)&&void 0!==t&&t.appointmentBooked&&(s[a]={date:M(n.hasMonteur.appointmentBooked.date),startTime:n.hasMonteur.appointmentBooked.startTime,endTime:n.hasMonteur.appointmentBooked.endTime,weekNumber:n.hasMonteur.appointmentBooked.weekNumber,type:n.hasMonteur.appointmentBooked.type||"HAS",hasMonteurName:n.hasMonteur.hasMonteurName||N.hasMonteurName,complaintDetails:n.hasMonteur.appointmentBooked.complaintDetails||""})})),f(s);const i=await t.get("/api/building/".concat(e));p(i.data),alert("Appointments saved successfully!")}catch(s){o.Z.error("Error saving appointments:",s),alert("Error saving appointments. Please try again.")}finally{u(!1)}},className:"ts-form",children:[(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"Appointment Type:"}),(0,m.jsxs)("div",{className:"ts-radioGroup",children:[(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",name:"type",value:"HAS",checked:"HAS"===N.type,onChange:g}),"HAS"]}),(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",name:"type",value:"Storing",checked:"Storing"===N.type,onChange:g}),"Storing"]}),(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",name:"type",value:"Complaint",checked:"Complaint"===N.type,onChange:g}),"Complaint"]})]})]}),"Complaint"===N.type&&(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"Complaint Details:"}),(0,m.jsx)("textarea",{name:"complaintDetails",value:N.complaintDetails,onChange:g,className:"ts-input",rows:"4",placeholder:"Enter complaint details",required:"Complaint"===N.type})]}),(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"Appointment Date:"}),(0,m.jsx)("input",{type:"date",name:"date",value:N.date,onChange:g,className:"ts-input",required:!0})]}),(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"Start Time:"}),(0,m.jsx)("input",{type:"time",name:"startTime",value:N.startTime,onChange:g,className:"ts-input",required:!0})]}),(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"End Time:"}),(0,m.jsx)("input",{type:"time",name:"endTime",value:N.endTime,onChange:g,className:"ts-input",required:!0})]}),(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"Week Number:"}),(0,m.jsx)("input",{type:"number",name:"weekNumber",value:N.weekNumber||"",readOnly:!0,className:"ts-input"})]}),(0,m.jsxs)("div",{className:"ts-formGroup",children:[(0,m.jsx)("label",{children:"HAS Monteur:"}),(0,m.jsxs)("select",{name:"hasMonteurName",value:N.hasMonteurName,onChange:g,className:"ts-input",children:[(0,m.jsx)("option",{value:"",children:"Select a HAS Monteur"}),x.map((e=>(0,m.jsx)("option",{value:e.name,children:e.name},e._id)))]})]}),(0,m.jsx)("button",{type:"submit",className:"ts-saveButton",disabled:c||0===h.length,children:c?"Saving...":"Save Appointment"})]})]})]})]})}},4225:()=>{}}]);
//# sourceMappingURL=586.3c971c8a.chunk.js.map