"use strict";(self.webpackChunkdynet=self.webpackChunkdynet||[]).push([[675],{3675:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var o=n(1413),a=n(2791),i=n(7689),r=n(4391),s=n(6965),l=n(9105),d=n(1896),c=(n(4225),n(184));const h=()=>{const{id:e}=(0,i.UO)(),t=((0,i.s0)(),(0,s.Z)()),[n,h]=(0,a.useState)(null),[p,x]=(0,a.useState)(!0),[u,m]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[f,y]=(0,a.useState)({date:"",startTime:"",endTime:"",weekNumber:null,technischeSchouwerName:""}),[S,w]=(0,a.useState)({}),v=e=>{const t=new Date(e),n=new Date(t.getFullYear(),0,1),o=Math.floor((t-n)/864e5);return Math.ceil(o/7)},j=e=>{if(!e)return"";return new Date(e).toISOString().split("T")[0]},k=async()=>{try{const{data:n}=await t.get("/api/building/".concat(e));h(n);const o={};n.flats.forEach((e=>{var t,n;null!==(t=e.technischePlanning)&&void 0!==t&&null!==(n=t.appointmentBooked)&&void 0!==n&&n.date&&(o[e._id]={date:j(e.technischePlanning.appointmentBooked.date),startTime:e.technischePlanning.appointmentBooked.startTime,endTime:e.technischePlanning.appointmentBooked.endTime,weekNumber:e.technischePlanning.appointmentBooked.weekNumber,technischeSchouwerName:e.technischePlanning.technischeSchouwerName||""})})),w(o);const a=n.flats.filter((e=>{var t,n;return null===(t=e.technischePlanning)||void 0===t||null===(n=t.appointmentBooked)||void 0===n?void 0:n.date})).map((e=>e._id));m(a),x(!1)}catch(n){r.Z.error("Error fetching building data",n),x(!1)}};(0,a.useEffect)((()=>{k(),(async()=>{try{const e=(await t.get("/api/users")).data.filter((e=>e.roles&&"object"===typeof e.roles&&8687===e.roles.TechnischeSchouwer));r.Z.log("Found Technische Schouwers:",e),b(e)}catch(e){r.Z.error("Error fetching technische schouwers:",e)}})()}),[e,t]);const N=e=>{const{name:t,value:n}=e.target;y((e=>(0,o.Z)((0,o.Z)({},e),{},{[t]:n},"date"===t?{weekNumber:v(n)}:{})))};if(p)return(0,c.jsx)(d.Gu,{message:"Loading building data..."});const T=n.flats||[],C=(0,l.c)(n,T),z="".concat(n.address).concat(C?" (".concat(C,")"):"");return(0,c.jsxs)("div",{className:"ts-apartmentDetailsContainer",children:[(0,c.jsxs)("h2",{children:["Apartment Schedule for ",z]}),(0,c.jsxs)("div",{className:"ts-columns",children:[(0,c.jsxs)("div",{className:"ts-leftColumn",children:[(0,c.jsx)("h3",{children:"Select Apartments for Appointment"}),n.flats.map((e=>(0,c.jsxs)("div",{className:"ts-apartmentDetails",children:[(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"checkbox",checked:u.includes(e._id),onChange:()=>{return t=e._id,void m((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t}}),e.adres," ",e.huisNummer,e.toevoeging]}),u.includes(e._id)&&S[e._id]&&(0,c.jsx)("div",{className:"appointmentDetails",children:(0,c.jsxs)("div",{className:"ts-formGroup",children:[(0,c.jsx)("label",{children:"Current Appointment:"}),(0,c.jsxs)("div",{children:["Date: ",new Date(S[e._id].date).toLocaleDateString()]}),(0,c.jsxs)("div",{children:["Time: ",S[e._id].startTime," - ",S[e._id].endTime]}),(0,c.jsxs)("div",{children:["Week: ",S[e._id].weekNumber]}),S[e._id].technischeSchouwerName&&(0,c.jsxs)("div",{children:["Technische Schouwer: ",S[e._id].technischeSchouwerName]})]})})]},e._id)))]}),(0,c.jsx)("div",{className:"ts-rightColumn",children:(0,c.jsxs)("div",{style:{background:"linear-gradient(135deg, #f8fafc 0%, #ffffff 100%)",border:"2px solid #e2e8f0",borderRadius:"16px",padding:"32px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.05)"},children:[(0,c.jsxs)("h3",{style:{color:"#1e293b",fontSize:"24px",fontWeight:"600",margin:"0 0 24px 0",display:"flex",alignItems:"center",gap:"12px"},children:[(0,c.jsx)("span",{style:{fontSize:"24px"},children:"\ud83d\udcc5"}),"Schedule Technical Inspection"]}),(0,c.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),x(!0);try{await Promise.all(u.map((async e=>{await t.put("/api/apartment/".concat(e,"/technische-planning"),{appointmentBooked:{date:f.date,startTime:f.startTime,endTime:f.endTime,weekNumber:f.weekNumber},technischeSchouwerName:f.technischeSchouwerName})}))),await k(),alert("Appointments saved successfully!")}catch(n){r.Z.error("Error saving appointments:",n),alert("Error saving appointments. Please try again.")}finally{x(!1)}},style:{display:"flex",flexDirection:"column",gap:"20px"},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#374151",fontSize:"16px",fontWeight:"500"},children:"\ud83d\udcc5 Inspection Date"}),(0,c.jsx)("input",{type:"date",name:"date",value:f.date,onChange:N,required:!0,style:{width:"100%",padding:"12px 16px",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"16px",fontFamily:"inherit",transition:"all 0.2s ease",backgroundColor:"#ffffff",color:"#374151",outline:"none",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)"},onBlur:e=>{e.target.style.borderColor="#e5e7eb",e.target.style.boxShadow="none"}})]}),(0,c.jsxs)("div",{style:{display:"grid",gap:"20px",gridTemplateColumns:"1fr 1fr"},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#374151",fontSize:"16px",fontWeight:"500"},children:"\ud83d\udd50 Start Time"}),(0,c.jsx)("input",{type:"time",name:"startTime",value:f.startTime,onChange:N,required:!0,style:{width:"100%",padding:"12px 16px",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"16px",fontFamily:"inherit",transition:"all 0.2s ease",backgroundColor:"#ffffff",color:"#374151",outline:"none",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)"},onBlur:e=>{e.target.style.borderColor="#e5e7eb",e.target.style.boxShadow="none"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#374151",fontSize:"16px",fontWeight:"500"},children:"\ud83d\udd50 End Time"}),(0,c.jsx)("input",{type:"time",name:"endTime",value:f.endTime,onChange:N,required:!0,style:{width:"100%",padding:"12px 16px",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"16px",fontFamily:"inherit",transition:"all 0.2s ease",backgroundColor:"#ffffff",color:"#374151",outline:"none",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)"},onBlur:e=>{e.target.style.borderColor="#e5e7eb",e.target.style.boxShadow="none"}})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#374151",fontSize:"16px",fontWeight:"500"},children:"\ud83d\udcca Week Number (Auto-calculated)"}),(0,c.jsx)("input",{type:"number",name:"weekNumber",value:f.weekNumber||"",readOnly:!0,style:{width:"100%",padding:"12px 16px",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"16px",fontFamily:"inherit",backgroundColor:"#f9fafb",color:"#6b7280",outline:"none",boxSizing:"border-box"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#374151",fontSize:"16px",fontWeight:"500"},children:"\ud83d\udc77 Technical Inspector"}),(0,c.jsxs)("select",{name:"technischeSchouwerName",value:f.technischeSchouwerName,onChange:N,style:{width:"100%",padding:"12px 16px",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"16px",fontFamily:"inherit",transition:"all 0.2s ease",backgroundColor:"#ffffff",color:"#374151",outline:"none",boxSizing:"border-box"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)"},onBlur:e=>{e.target.style.borderColor="#e5e7eb",e.target.style.boxShadow="none"},children:[(0,c.jsx)("option",{value:"",children:"Select a Technical Inspector"}),g.map((e=>(0,c.jsx)("option",{value:e.name,children:e.name},e._id)))]})]}),(0,c.jsxs)("button",{type:"submit",disabled:p||0===u.length,style:{background:p||0===u.length?"linear-gradient(135deg, #9ca3af, #6b7280)":"linear-gradient(135deg, #667eea, #764ba2)",color:"white",border:"none",padding:"14px 28px",borderRadius:"10px",fontSize:"16px",fontWeight:"600",cursor:p||0===u.length?"not-allowed":"pointer",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:"10px",justifyContent:"center",alignSelf:"flex-start"},onMouseEnter:e=>{!p&&u.length>0&&(e.target.style.transform="translateY(-2px)",e.target.style.boxShadow="0 8px 25px rgba(102, 126, 234, 0.3)")},onMouseLeave:e=>{e.target.style.transform="translateY(0)",e.target.style.boxShadow="none"},children:[(0,c.jsx)("span",{style:{fontSize:"18px"},children:p?"\u23f3":"\ud83d\udcbe"}),p?"Saving Appointment...":"Save Appointment"]})]})]})})]})]})}},4225:()=>{}}]);
//# sourceMappingURL=675.cfda4b9a.chunk.js.map