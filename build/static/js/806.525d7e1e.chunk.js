"use strict";(self.webpackChunkdynet=self.webpackChunkdynet||[]).push([[806],{6790:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var i=n(1413),s=n(2791),a=n(7689),l=n(1087),r=n(4391),c=n(6965),o=n(7834),d=n(9234),u=n(184);const m=e=>{let{districts:t=[],getBuildings:n,setCurrentDistrict:s,currentDistrict:a,buildings:l=[]}=e;r.Z.debug("DistrictButtons rendered with ".concat(t.length," districts and ").concat(l.length," buildings"));return 0===t.length?(0,u.jsxs)("div",{className:"districts-empty-state",children:[(0,u.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcc1"}),(0,u.jsx)("h3",{children:"No Districts Available"}),(0,u.jsx)("p",{children:"Create districts through the enhanced management panel to get started."})]}):(0,u.jsxs)("div",{className:"districts-container",children:[(0,u.jsxs)("div",{className:"districts-header",children:[(0,u.jsxs)("h3",{className:"districts-title",children:[(0,u.jsx)("span",{className:"districts-icon",children:"\ud83d\uddc2\ufe0f"}),"District Navigation",(0,u.jsxs)("span",{className:"districts-count",children:["(",t.length,")"]})]}),(0,u.jsxs)("div",{className:"districts-help",children:[(0,u.jsx)("span",{className:"help-icon",children:"\ud83d\udca1"}),(0,u.jsx)("span",{className:"help-text",children:"Drag to reorder \u2022 Click to view"})]})]}),(0,u.jsx)("div",{className:"districts-grid",children:t.map(((e,t)=>{const r=(e=>({buildingCount:l.filter((t=>t.district===e._id)).length,priority:e.priority||0}))(e),c=(null===a||void 0===a?void 0:a._id)===e._id;return(0,u.jsx)(d._l,{draggableId:e._id,index:t,children:(t,a)=>(0,u.jsxs)("div",(0,i.Z)((0,i.Z)({ref:t.innerRef},t.draggableProps),{},{className:"district-card ".concat(c?"active":""," ").concat(a.isDragging?"dragging":""),children:[(0,u.jsx)("div",(0,i.Z)((0,i.Z)({},t.dragHandleProps),{},{className:"district-drag-handle",title:"Drag to reorder districts",children:(0,u.jsxs)("div",{className:"drag-dots",children:[(0,u.jsx)("div",{className:"drag-dot"}),(0,u.jsx)("div",{className:"drag-dot"}),(0,u.jsx)("div",{className:"drag-dot"}),(0,u.jsx)("div",{className:"drag-dot"}),(0,u.jsx)("div",{className:"drag-dot"}),(0,u.jsx)("div",{className:"drag-dot"})]})})),(0,u.jsxs)("div",{className:"district-content",children:[(0,u.jsxs)("div",{className:"district-header",children:[(0,u.jsxs)("div",{className:"district-info",children:[(0,u.jsx)("h4",{className:"district-name",children:e.name}),(0,u.jsxs)("div",{className:"district-metadata",children:[(0,u.jsxs)("span",{className:"district-priority",children:["#",r.priority]}),(0,u.jsxs)("span",{className:"district-buildings",children:["\ud83c\udfe2 ",r.buildingCount," buildings"]})]})]}),c&&(0,u.jsxs)("div",{className:"active-indicator",children:[(0,u.jsx)("span",{className:"active-dot"}),(0,u.jsx)("span",{className:"active-text",children:"Current"})]})]}),(0,u.jsx)("button",{onClick:()=>(e=>{s(e),n(e._id)})(e),className:"district-button ".concat(c?"active":""),disabled:c,children:c?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"button-icon",children:"\u2713"}),"Currently Viewing"]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"button-icon",children:"\ud83d\udc41\ufe0f"}),"View Buildings"]})})]})]}))},e._id)}))})]})},g=e=>{let{searchQuery:t,onSearch:n}=e;return(0,u.jsx)("input",{type:"text",placeholder:"Search by Complex Naam or Address",value:t,onChange:n,className:"searchInput"})},h=s.memo(g),p=[{key:"fileUrl",label:"With File URL"},{key:"laagBouw",label:"Laag Bouw"},{key:"HB",label:"HB"},{key:"duplex",label:"Duplex"},{key:"appointment",label:"With Appointment"},{key:"done",label:"Completed"},{key:"pending",label:"Pending"},{key:"noappointment",label:"No Appointment"},{key:"blocked",label:"\ud83d\udeab Blocked",className:"blocked-filter"},{key:"all",label:"All"}],x=e=>{let{currentFilter:t,filterCounts:n,onFilterChange:i,onClearAll:s,hasActiveFilters:a}=e;return(0,u.jsxs)("div",{className:"filterButtons",children:[p.map((e=>{let{key:s,label:a,className:l}=e;return(0,u.jsxs)("button",{onClick:()=>i(s),className:"".concat(t===s?"active":""," ").concat(l||""),children:[a," ",(0,u.jsxs)("span",{className:"filter-count",children:["(",n[s]||0,")"]})]},s)})),a&&(0,u.jsx)("button",{onClick:s,className:"clear-filters",title:"Clear all filters and search",children:"\u2715 Clear All"})]})},b=s.memo(x),f=e=>{let{flats:t,typeString:n,completionPercentage:i}=e;return(0,u.jsxs)("div",{className:"buildingVisual",children:[(0,u.jsx)("div",{className:"buildingStructure ".concat(n.toLowerCase().replace(" ","")),children:((e,t)=>{const n=e.length,i={};for(let l=0;l<n;l++){i[l+1]=[e[l]]}const s=[],a="Hoog bouw"===t?120:"Duplex"===t?100:80;return Object.keys(i).map(Number).sort(((e,t)=>t-e)).forEach(((e,n)=>{const l=i[e],r=l.filter((e=>"2"===e.fcStatusHas)).length/l.length*100,c=100===r,o=r>0&&r<100,d="Hoog bouw"===t?45:"Duplex"===t?40:35;s.push((0,u.jsxs)("div",{className:"buildingFloor ".concat(c?"completed":o?"partial":"pending"),style:{height:"".concat(d,"px"),width:"".concat(a,"px"),animationDelay:"".concat(.2*n,"s")},title:"Floor ".concat(e," - 1 flat - ").concat(Math.round(r),"% complete"),children:[(0,u.jsx)("div",{className:"floorNumber",children:e}),(0,u.jsx)("div",{className:"floorWindows",children:(0,u.jsx)("div",{className:"window ".concat("2"===l[0].fcStatusHas?"completed":"pending"),style:{animationDelay:"".concat(.2*n,"s")},title:"Flat: ".concat(l[0].adres," ").concat(l[0].huisNummer).concat(l[0].toevoeging)})}),(0,u.jsx)("div",{className:"floorProgress",style:{width:"".concat(r,"%")}})]},e))})),(0,u.jsxs)("div",{className:"verticalBuilding",children:[s,(0,u.jsx)("div",{className:"buildingFoundation",style:{width:"".concat(a,"px")},children:(0,u.jsx)("div",{className:"foundationLabel",children:"".concat(t," (").concat(n," flats)")})})]})})(t,n)}),(0,u.jsxs)("div",{className:"completionBadge","data-percentage":i,children:[i,"%"]})]})},v=s.memo(f);var N=n(3585);const j=e=>{let{children:t,flatId:n,buildingId:s,building:a,className:r,type:c,style:d}=e;const{auth:m}=(0,o.Z)();if(null!==a&&void 0!==a&&a.isBlocked&&"schedule"===c)return(0,u.jsx)("div",{className:r,style:(0,i.Z)((0,i.Z)({},d),{},{cursor:"not-allowed",opacity:.4}),title:"Building blocked: ".concat(a.blockReason),onClick:e=>{e.preventDefault(),alert("This building is blocked: ".concat(a.blockReason))},children:t});const g=e=>(null===m||void 0===m?void 0:m.roles)&&Array.isArray(m.roles)&&m.roles.includes(e),h=g(N.K$.ADMIN),p=g(N.K$.TECHNICAL_PLANNING),x=g(N.K$.HAS_PLANNING),b=g(N.K$.TECHNICAL_INSPECTOR),f=g(N.K$.HAS_MONTEUR),v=g(N.K$.WERKVOORBEREIDER);let j="/";if("schedule"===c&&s){if(!(h||p||x||v))return null;x?j="/has-appointment-scheduler/".concat(s,"?mode=building&type=HAS"):p||v?j="/appointment-scheduler/".concat(s,"?mode=building&type=Technical"):h&&(j="/admin-scheduling-selection/".concat(s,"?mode=building"))}else n&&(h?j="/admin-apartment/".concat(n):p?j="/planning-apartment/".concat(n):b?j="/ts-apartment/".concat(n):x?j="/has-planning-apartment/".concat(n):f?j="/hm-apartment/".concat(n):v&&(j="/planning-apartment/".concat(n)));return(0,u.jsx)(l.rU,{to:j,className:r,style:d,children:t})};var k=n(9105);const y=e=>"2"===e.fcStatusHas||(e=>{var t,n,i,s,a,l,r,c;return!!(null!==(t=e.technischePlanning)&&void 0!==t&&null!==(n=t.signature)&&void 0!==n&&n.fileUrl||null!==(i=e.technischePlanning)&&void 0!==i&&null!==(s=i.report)&&void 0!==s&&s.fileUrl||null!==(a=e.hasMonteur)&&void 0!==a&&null!==(l=a.signature)&&void 0!==l&&l.fileUrl||null!==(r=e.hasMonteur)&&void 0!==r&&null!==(c=r.report)&&void 0!==c&&c.fileUrl)})(e),C=e=>(e=>{var t,n;return!(null===(t=e.technischePlanning)||void 0===t||null===(n=t.appointmentBooked)||void 0===n||!n.date)})(e)||(e=>{var t,n;return!(null===(t=e.hasMonteur)||void 0===t||null===(n=t.appointmentBooked)||void 0===n||!n.date)})(e),A=e=>{var t,n;let{building:i,isWerkvoorbereider:s,onToggleBlock:a}=e;const r=i.flats||[],{types:c,typeString:o}=(0,k.p)(r),d=[...r].sort(w),m=d.length,g=(0,k.c)(i,d),h=d.filter((e=>y(e))).length,p=m>0?Math.round(h/m*100):0;return(0,u.jsxs)("div",{className:"buildingContainer",children:[(0,u.jsx)(v,{flats:d,typeString:o,completionPercentage:p}),(0,u.jsxs)("div",{className:"buildingInfo ".concat(i.isBlocked?"blocked-building":""),children:[i.isBlocked&&(0,u.jsxs)("div",{className:"block-indicator",children:[(0,u.jsx)("span",{className:"block-icon",children:"\ud83d\udeab"}),(0,u.jsx)("span",{className:"block-text",children:"BLOCKED"}),(0,u.jsx)("div",{className:"block-reason",children:i.blockReason})]}),(0,u.jsxs)("div",{className:"buildingHeaderSection",children:[(0,u.jsx)(l.rU,{to:"/building/".concat(i._id),style:{opacity:i.isBlocked?.6:1},children:(0,u.jsxs)("div",{className:"buildingHeader",children:[(null===(t=i.flats)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.complexNaam)||i.address,g&&(0,u.jsx)("div",{className:"hbNumber",style:{fontSize:"0.9em",color:"#666",fontWeight:"normal",marginTop:"2px"},children:g})]})}),(0,u.jsx)("div",{className:"flatCountBox",children:m}),s&&(0,u.jsx)("button",{onClick:()=>a(i),className:"block-toggle-btn ".concat(i.isBlocked?"blocked":"active"),title:i.isBlocked?"Unblock building":"Block building",children:i.isBlocked?"\ud83d\udd13":"\ud83d\udd12"}),(0,u.jsx)(j,{buildingId:i._id,building:i,type:"schedule",className:"editIconLink",style:{opacity:i.isBlocked?.4:1,pointerEvents:i.isBlocked?"none":"auto"},children:(0,u.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAEJklEQVR4Xu2bz8sNURjH71skGwsrWVizl8W78eZHRCIbG/wBWPhVosRCUX6WhZ1iZUfJi0hK2VDssLWRlUgkiu+TOxm3e+88zzPPmXPmnGfqqene55yZ8/mcM3PO3LkzA9+iEpiJenQ/+MAFRO4ELsAFRCYQ+fA+AlxAZAKRD+8jwAVEJhD58D4CXEBkApEP7yPABUQm8O/wS7C7H7EGsQqxAvEe8QbxCnEV8cn6bH0E/CW6HXEdsXQK4M/4bifiiaUEFzAYHATQy0yo35C3GfGMmd+YVrqAA8NLSyOoWsJ37G9APJcUmpRbsgAN/IqjmYRSBbSBbyqhRAEW8M0klCbAEr6JhJIEhIBfSfiKndWId9IbcykCjgDMBSkcYT7BXyksU8RvwocA5ZIUjDJ/H8pdk5TNfQSEvOyM4/xwuFBjO8hZQNfwCfoHxHI2fSTmKuAw2nZRAsIwV8RUlGx4kiGritHzq/Z8xM4ySeNyExATPnGnJ6XrSxVwFA0/L2l8gNyTqPOMpN5cRkDsnk/MfyHoRxy6EbO3HASk0PMJOJ2H+MbfdwHH0OhzzO72EnlvEbuZ+ZI0mnVxf9T5r94+C5D0/Ndo9VrEF8QNxF4J3YZcWmlf0dbXVwFa+BUnKwmt4NPJ9FGABP4LtJF+PqSeP7rdxAd7tD0X5VrD76MAKfx1aCQ9Kp603cIXuxQSTOD3TYA1/Ir7bezsEEgwg98nAaHgLwCEO4itTAGm8PsiIFv4fRCQNfzUBWQPP2UBRcBPVUAx8FMUEAr+QjSWppvRZjuTZlkprYRDwr8HABtjTTWnHTcVARL49FbypoYVbtVm6vnJwk/lEiSFT8926O3kpi15+CkIKBp+bAHFw48pwOEPL6AxbsIOv3b36lqAwx+ZOnQpwOGPmbd1JSAV+MfBgPsWRdM01+T7LgQ4/CmqQgsIBX8R2nRX8HghuZ5fOQkpQAL/KU5oC3OFS/AfIOaY14Bk4YdcB5xG5aeYgAg+/f3/ByM/K/ihBNAbytT7OVvR8EMIcPicblfLsbwHOHwhfMsR4PAV8K0EOHwlfAsBDr8F/LYCHH5L+G0EOHwD+FoBoeAvxgnNI+aYbUt6hctsg+oPGr+ZlT9C3jbmCpfgP0bMMuvOAr52BHAEEHx6CeonA2ix8EMJcPiMXlelaFbCTSOAWyf1/PsI+vciZzuBpLOcxD7lcGHV22QhoOjLTh1mDAEOv2agawEOf+T62KUAhz/m5tSVAIc/YWYQQkDbSUg2iywOiNQEFAU/1EKMI35cTnHwUxJQJPxUBBQLPwUBRcOPLaB4+DEFOPzhNEQzDdXOcryc0UrYQRoS8BFgCFNTlQvQUDMs4wIMYWqqcgEaaoZlXIAhTE1VLkBDzbCMCzCEqanKBWioGZZxAYYwNVW5AA01wzJ/AHjhFXBvCtlXAAAAAElFTkSuQmCC",alt:"Edit",className:"editIcon"})})]}),(0,u.jsx)("div",{className:"buildingType","data-type":o,children:(0,u.jsx)("b",{children:o})}),(0,u.jsx)("div",{className:"flatsWrapper",children:(0,u.jsx)(B,{flats:d,types:c,building:i})})]})]})},w=(e,t)=>{var n,i,s,a,l,r;const c=(null===e||void 0===e||null===(n=e.toevoeging)||void 0===n||null===(i=n.toString())||void 0===i||null===(s=i.trim())||void 0===s?void 0:s.toUpperCase())||"",o=(null===t||void 0===t||null===(a=t.toevoeging)||void 0===a||null===(l=a.toString())||void 0===l||null===(r=l.trim())||void 0===r?void 0:r.toUpperCase())||"";if(!c&&!o)return 0;if(!c)return 1;if(!o)return-1;const d=["H","BG","GF","G","0","00"],u=d.includes(c),m=d.includes(o);if(u&&!m)return 1;if(!u&&m)return-1;if(u&&m)return 0;const g=parseInt(c,10),h=parseInt(o,10),p=!isNaN(g),x=!isNaN(h);return p&&x?h-g:p&&!x?-1:!p&&x?1:o.localeCompare(c)},B=e=>{let{flats:t,types:n,building:i}=e;if(!t||0===t.length)return null;if(1===t.length&&n.some((e=>"Laag bouw"===e.type))){const e=t[0],n=C(e),s=n?"flatLink flatWithAppointment":"flatLink",a=e.toevoeging?"".concat(i.address," ").concat(e.toevoeging):i.address;return(0,u.jsx)(j,{flatId:e._id,className:s,children:(0,u.jsx)("div",{className:"flatInfo",style:{backgroundColor:n?"#90EE90":"inherit"},children:a})},e._id)}return t.map((e=>{if(!e)return null;const t=C(e),n=t?"flatLink flatWithAppointment":"flatLink",i=e.complexNaam?"".concat(e.complexNaam).concat(e.toevoeging?" - ".concat(e.toevoeging):""):"".concat(e.adres||""," ").concat(e.huisNummer||"").concat(e.toevoeging||"").trim();return(0,u.jsx)(j,{flatId:e._id,className:n,children:(0,u.jsx)("div",{className:"flatInfo",style:{backgroundColor:t?"#90EE90":"inherit"},children:i||"Unknown flat"})},e._id)}))},E=s.memo(A),O=e=>{let{currentPage:t,totalPages:n,onPageChange:i}=e;if(n<=1)return null;return(0,u.jsxs)("div",{className:"pagination",children:[(0,u.jsx)("button",{onClick:()=>i(t-1),disabled:1===t,className:"pagination-nav",children:"Previous"}),(()=>{const e=[],i=t>3,s=t<n-2;if(n<=7)for(let t=1;t<=n;t++)e.push(t);else{e.push(1),i&&e.push("...");const a=Math.max(2,t-1),l=Math.min(n-1,t+1);for(let t=a;t<=l;t++)e.includes(t)||e.push(t);s&&e.push("..."),e.includes(n)||e.push(n)}return e})().map(((e,n)=>"..."===e?(0,u.jsx)("span",{className:"pagination-ellipsis",children:"..."},"ellipsis-".concat(n)):(0,u.jsx)("button",{onClick:()=>i(e),className:t===e?"activePage":"",children:e},e))),(0,u.jsx)("button",{onClick:()=>i(t+1),disabled:t===n,className:"pagination-nav",children:"Next"})]})},S=s.memo(O),D=(e,t,n)=>{let i=e;if(!e)return[];switch(t&&(i=e.filter((e=>e.address.toLowerCase().includes(t)||e.flats&&e.flats.some((e=>e.complexNaam&&e.complexNaam.toLowerCase().includes(t)))))),n){case"fileUrl":return i.filter((e=>e.fileUrl||e.flats&&e.flats.some((e=>e.fileUrl))));case"laagBouw":return i.filter((e=>{if(!e.flats||0===e.flats.length)return!1;const{typeString:t}=(0,k.p)(e.flats);return"Laag bouw"===t}));case"HB":return i.filter((e=>{if(!e.flats||0===e.flats.length)return!1;const{typeString:t}=(0,k.p)(e.flats);return"Hoog bouw"===t}));case"duplex":return i.filter((e=>{if(!e.flats||0===e.flats.length)return!1;const{typeString:t}=(0,k.p)(e.flats);return"Duplex"===t}));case"appointment":return i.filter((e=>e.flats&&e.flats.some((e=>C(e)))));case"done":return i.filter((e=>e.flats&&e.flats.length>0&&e.flats.every((e=>y(e)))));case"pending":return i.filter((e=>e.flats&&e.flats.some((e=>!y(e)))));case"noappointment":return i.filter((e=>e.flats&&e.flats.every((e=>!C(e)))));case"blocked":return i.filter((e=>!0===e.isBlocked));default:return i}};var I=n(1896),P=n(2152);const H=e=>{var t,n;let{buildings:a,isLoading:l}=e;const[o,d]=(0,s.useState)(""),[m,g]=(0,s.useState)("all"),[p,x]=(0,s.useState)(1),{auth:f}=(0,s.useContext)(P.Z),v=(0,c.Z)(),[j,k]=(0,s.useState)({isOpen:!1,message:""}),[C,A]=(0,s.useState)({isOpen:!1,building:null}),[w,B]=(0,s.useState)({isOpen:!1,building:null,reason:""});(0,s.useEffect)((()=>{x(1)}),[m,o,a]);const O=(0,s.useCallback)((e=>{d(e.target.value.toLowerCase())}),[]),H=(0,s.useCallback)((e=>{g((t=>t===e?"all":e))}),[]),F=(0,s.useCallback)((()=>{g("all"),d("")}),[]),M=(0,s.useCallback)((e=>{x(e),window.scrollTo({top:0,behavior:"smooth"})}),[]),U=(0,s.useMemo)((()=>{var e;return null===f||void 0===f||null===(e=f.roles)||void 0===e?void 0:e.includes(N.K$.WERKVOORBEREIDER)}),[f]),L=(0,s.useCallback)((async(e,t)=>{try{(await v.put("/api/building/block/".concat(e),{reason:t.trim()})).data&&window.location.reload()}catch(n){r.Z.error("Error blocking building:",n),k({isOpen:!0,message:"Failed to block building. Please try again."})}}),[v]),R=(0,s.useCallback)((async e=>{try{(await v.put("/api/building/unblock/".concat(e),{})).data&&window.location.reload()}catch(t){r.Z.error("Error unblocking building:",t),k({isOpen:!0,message:"Failed to unblock building. Please try again."})}}),[v]),T=(0,s.useCallback)((e=>{e.isBlocked?A({isOpen:!0,building:e}):B({isOpen:!0,building:e,reason:""})}),[]),Z=(0,s.useCallback)((()=>{C.building&&R(C.building._id),A({isOpen:!1,building:null})}),[C.building,R]),_=(0,s.useCallback)((()=>{w.building&&w.reason.trim()&&L(w.building._id,w.reason),B({isOpen:!1,building:null,reason:""})}),[w,L]),Q=(0,s.useMemo)((()=>(e=>e&&0!==e.length?{all:e.length,fileUrl:D(e,"","fileUrl").length,laagBouw:D(e,"","laagBouw").length,HB:D(e,"","HB").length,duplex:D(e,"","duplex").length,appointment:D(e,"","appointment").length,done:D(e,"","done").length,pending:D(e,"","pending").length,noappointment:D(e,"","noappointment").length,blocked:D(e,"","blocked").length}:{all:0,fileUrl:0,laagBouw:0,HB:0,duplex:0,appointment:0,done:0,pending:0,noappointment:0,blocked:0})(a)),[a]),V=(0,s.useMemo)((()=>a?D(a,o,m):[]),[a,o,m]),K=(0,s.useMemo)((()=>(e=>{if(!e||0===e.length)return{percentage:0,completedFlats:0,totalFlats:0};let t=0,n=0;return e.forEach((e=>{e.flats&&(t+=e.flats.length,n+=e.flats.filter((e=>y(e))).length)})),{percentage:t>0?(n/t*100).toFixed(2):0,completedFlats:n,totalFlats:t}})(V)),[V]),W=Math.ceil(V.length/20),G=(0,s.useMemo)((()=>{const e=20*(p-1);return V.slice(e,e+20)}),[V,p]),Y="all"!==m||o;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"searchContainer",children:[(0,u.jsx)(h,{searchQuery:o,onSearch:O}),(0,u.jsx)(b,{currentFilter:m,filterCounts:Q,onFilterChange:H,onClearAll:F,hasActiveFilters:Y}),(0,u.jsxs)("div",{className:"resultsCount",children:[(0,u.jsx)("strong",{children:V.length})," results found",l&&(0,u.jsx)("span",{className:"loadingIndicator",children:" \u2022 Refreshing..."})]})]}),(0,u.jsx)("div",{className:"completionPercentage",children:"Completion Status: ".concat(K.completedFlats," / ").concat(K.totalFlats," (").concat(K.percentage,"%)")}),l&&!a?(0,u.jsx)("div",{className:"loadingContainer",style:{padding:"40px",textAlign:"center",color:"#666"},children:"Loading buildings..."}):(0,u.jsx)("div",{className:"buildingsList",children:G.map((e=>(0,u.jsx)(E,{building:e,isWerkvoorbereider:U,onToggleBlock:T},e._id)))}),(0,u.jsx)(S,{currentPage:p,totalPages:W,onPageChange:M}),(0,u.jsx)(I.VF,{isOpen:j.isOpen,title:"Error",message:j.message,onClose:()=>k({isOpen:!1,message:""})}),(0,u.jsx)(I.sm,{isOpen:C.isOpen,title:"Unblock Building",message:'Are you sure you want to unblock "'.concat(null===(t=C.building)||void 0===t?void 0:t.address,'"?'),confirmText:"Unblock",onConfirm:Z,onCancel:()=>A({isOpen:!1,building:null})}),w.isOpen&&(0,u.jsx)(I.sm,{isOpen:!0,title:"Block Building",message:(0,u.jsxs)("div",{children:[(0,u.jsxs)("p",{children:['Enter reason for blocking "',null===(n=w.building)||void 0===n?void 0:n.address,'":']}),(0,u.jsx)("textarea",{value:w.reason,onChange:e=>B((t=>(0,i.Z)((0,i.Z)({},t),{},{reason:e.target.value}))),placeholder:"Enter blocking reason...",style:{width:"100%",minHeight:"80px",padding:"8px",borderRadius:"4px",border:"1px solid #ddd",marginTop:"10px",fontSize:"14px"},autoFocus:!0})]}),confirmText:"Block",confirmVariant:"danger",onConfirm:_,onCancel:()=>B({isOpen:!1,building:null,reason:""})})]})};var F=n(8421);const M={districts:new Map,buildings:new Map,timestamps:new Map},U=e=>{const t=M.timestamps.get(e);return t&&Date.now()-t<3e5},L=()=>{var e,t,n;const g=(0,c.Z)(),{auth:h}=(0,o.Z)(),{areaId:p}=(0,a.UO)(),[x,b]=(0,s.useState)([]),[f,v]=(0,s.useState)(null),[j,k]=(0,s.useState)([]),[y,C]=(0,s.useState)(!0),[A,w]=(0,s.useState)(!1),B=(0,s.useCallback)((()=>{const e=window.pageYOffset||document.documentElement.scrollTop;localStorage.setItem("scroll_district_".concat(p),e.toString())}),[p]),E=(0,s.useCallback)((e=>{null!==e&&void 0!==e&&e._id&&localStorage.setItem("currentDistrict_".concat(p),e._id)}),[p]),O=(0,s.useCallback)((e=>{const t=localStorage.getItem("currentDistrict_".concat(p));if(t&&e.length>0){const n=e.find((e=>e._id===t));if(n)return n}return e[0]}),[p]),S=(0,s.useCallback)((()=>{const e=localStorage.getItem("scroll_district_".concat(p));if(e&&"0"!==e){const t=parseInt(e,10);isNaN(t)||requestAnimationFrame((()=>{window.scrollTo(0,t)}))}}),[p]),D=(0,s.useCallback)((async()=>{const e="districts_".concat(p);if(U(e)&&M.districts.has(e)){const t=M.districts.get(e);if(b(t),C(!1),!f&&t.length>0){const e=O(t);v(e)}}else try{C(!0);const t=await g.get("/api/district/area/".concat(p));if(M.districts.set(e,t.data),M.timestamps.set(e,Date.now()),b(t.data),!f&&t.data.length>0){const e=O(t.data);v(e)}}catch(t){r.Z.error("Error fetching districts:",t)}finally{C(!1)}}),[p,g,f,O]),I=(0,s.useCallback)((async e=>{if(!e)return void k([]);const t="buildings_".concat(e);if(U(t)&&M.buildings.has(t)){const e=M.buildings.get(t);return k(e),w(!1),void setTimeout(S,10)}try{w(!0);const n=(await g.get("/api/district/".concat(e))).data.buildings||[];M.buildings.set(t,n),M.timestamps.set(t,Date.now()),k(n),setTimeout(S,50)}catch(n){r.Z.error("Error fetching buildings:",n),k([])}finally{w(!1)}}),[g,S]);(0,s.useEffect)((()=>{D()}),[D]),(0,s.useEffect)((()=>{null!==f&&void 0!==f&&f._id&&I(f._id)}),[null===f||void 0===f?void 0:f._id,I]);const P=(0,s.useCallback)((async e=>{B();const t=x.find((t=>t._id===e));t&&(v(t),E(t))}),[x,B,E]);(0,s.useEffect)((()=>{const e=()=>{M.buildings.clear(),M.timestamps.clear()};return window.addEventListener("invalidate-buildings-cache",e),()=>{window.removeEventListener("invalidate-buildings-cache",e)}}),[]);(0,s.useEffect)((()=>{const e=()=>{B()};return window.addEventListener("beforeunload",e),()=>{B(),window.removeEventListener("beforeunload",e)}}),[B]);const L=y||A;return(0,u.jsxs)("div",{className:"districtPageContainer",style:{padding:"20px"},children:[L&&(0,u.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",border:0},children:(0,u.jsx)(F.Z,{color:"#3498db"})}),(0,u.jsx)("h1",{style:{marginBottom:"20px"},children:"Districts Page"}),(0,u.jsxs)("div",{className:"cacheStatus",children:[(0,u.jsxs)("span",{children:["\ud83d\udcca Districts: ",x.length," loaded"]}),(0,u.jsxs)("span",{children:["\ud83c\udfe2 Buildings: ",j.length," loaded"]}),!y&&!A&&(0,u.jsx)("span",{children:"\u26a1 Cached - instant loading enabled"}),A&&(0,u.jsx)("span",{className:"loadingIndicator",children:"\u27f3 Loading buildings..."})]}),(0,u.jsxs)("div",{className:"modern-card",style:{marginBottom:"32px"},children:[(0,u.jsx)("div",{className:"modern-card-header",children:(0,u.jsxs)("h2",{className:"modern-card-title",children:[(0,u.jsx)("span",{style:{fontSize:"20px",marginRight:"8px"},children:"\ud83d\udcc1"}),"District Management"]})}),(0,u.jsx)("div",{className:"modern-card-body",children:(0,u.jsxs)("div",{style:{display:"grid",gridTemplateColumns:null!==h&&void 0!==h&&null!==(e=h.roles)&&void 0!==e&&e.includes(N.K$.ADMIN)?"repeat(auto-fit, minmax(250px, 1fr))":"1fr",gap:"20px",alignItems:"start"},children:[(null===h||void 0===h||null===(t=h.roles)||void 0===t?void 0:t.includes(N.K$.ADMIN))&&(0,u.jsxs)("div",{className:"modern-action-card",children:[(0,u.jsx)("div",{className:"modern-action-card-icon",style:{backgroundColor:"#e8f5e8"},children:"\ud83d\ude80"}),(0,u.jsx)("h3",{className:"modern-action-card-title",children:"Enhanced Management"}),(0,u.jsx)("p",{className:"modern-action-card-description",children:"Advanced file validation, preview, conflict detection, and batch import features."}),(0,u.jsxs)("div",{className:"modern-action-card-features",children:[(0,u.jsx)("div",{className:"modern-feature-tag",children:"\u2705 File Validation"}),(0,u.jsx)("div",{className:"modern-feature-tag",children:"\ud83d\udd0d Data Preview"}),(0,u.jsx)("div",{className:"modern-feature-tag",children:"\u26a0\ufe0f Conflict Detection"}),(0,u.jsx)("div",{className:"modern-feature-tag",children:"\ud83d\udcca Import History"})]}),(0,u.jsx)(l.rU,{to:"/district-management/".concat(p),className:"modern-button modern-button-primary",style:{width:"100%",justifyContent:"center"},children:"Open Enhanced Manager"})]}),(0,u.jsxs)("div",{className:"modern-action-card",children:[(0,u.jsx)("div",{className:"modern-action-card-icon",style:{backgroundColor:"#e8f4fd"},children:"\ud83d\udccb"}),(0,u.jsx)("h3",{className:"modern-action-card-title",children:"Quick Actions"}),(0,u.jsx)("p",{className:"modern-action-card-description",children:0===x.length?"No districts found. Use the enhanced manager to create your first district.":"Manage ".concat(x.length," district").concat(1!==x.length?"s":""," with drag & drop reordering.")}),(0,u.jsxs)("div",{className:"modern-action-card-stats",children:[(0,u.jsxs)("div",{className:"modern-stat-item",children:[(0,u.jsx)("span",{className:"modern-stat-number",children:x.length}),(0,u.jsx)("span",{className:"modern-stat-label",children:"Districts"})]}),(0,u.jsxs)("div",{className:"modern-stat-item",children:[(0,u.jsx)("span",{className:"modern-stat-number",children:j.length}),(0,u.jsx)("span",{className:"modern-stat-label",children:"Buildings"})]})]}),null!==h&&void 0!==h&&null!==(n=h.roles)&&void 0!==n&&n.includes(N.K$.ADMIN)?(0,u.jsx)("div",{className:"modern-info-note",children:"\ud83d\udca1 As an admin, you have access to enhanced management features above."}):(0,u.jsx)("div",{className:"modern-info-note",children:"\u2139\ufe0f Contact your administrator to create or import new districts."})]})]})})]}),(0,u.jsxs)("div",{style:{marginTop:"20px"},children:[(0,u.jsxs)("h2",{style:{marginBottom:"15px"},children:["Current District Name: ",(null===f||void 0===f?void 0:f.name)||"Loading..."]}),(0,u.jsx)(d.Z5,{onDragEnd:async e=>{if(!e.destination)return;const t=Array.from(x),[n]=t.splice(e.source.index,1);t.splice(e.destination.index,0,n),b(t);try{await g.post("/api/district/reorder",{districts:t.map(((e,t)=>({id:e._id,priority:t+1})))});const e="districts_".concat(p);M.districts.set(e,t),M.timestamps.set(e,Date.now())}catch(i){r.Z.error("Failed to reorder districts",i),D()}},children:(0,u.jsx)(d.bK,{droppableId:"districts",children:e=>(0,u.jsxs)("div",(0,i.Z)((0,i.Z)({},e.droppableProps),{},{ref:e.innerRef,children:[(0,u.jsx)(m,{districts:x,getBuildings:P,setCurrentDistrict:v,currentDistrict:f,buildings:j}),e.placeholder]}))})}),(0,u.jsx)(H,{buildings:j,isLoading:A})]})]})}}}]);
//# sourceMappingURL=806.525d7e1e.chunk.js.map