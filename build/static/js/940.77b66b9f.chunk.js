"use strict";(self.webpackChunkdynet=self.webpackChunkdynet||[]).push([[940],{4677:(e,s,t)=>{t.d(s,{Z:()=>l,y:()=>n});var i=t(3263);const r={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL||"https://backend-dynet2-1.onrender.com",n=i.Z.create({baseURL:r,headers:{"Content-Type":"application/json"},withCredentials:!0}),a=i.Z.create({baseURL:r,headers:{"Content-Type":"application/json"},withCredentials:!0});a.interceptors.response.use((e=>e),(async e=>{var s;return 401===(null===(s=e.response)||void 0===s?void 0:s.status)&&(localStorage.removeItem("accessToken"),localStorage.removeItem("roles"),window.location.href="/login"),Promise.reject(e)}));const l=a},6965:(e,s,t)=>{t.d(s,{Z:()=>o});var i=t(1413),r=t(2791),n=t(4677),a=t(4391),l=t(7834),c=t(3263);const o=()=>{const{auth:e,setAuth:s,logout:t}=(0,l.Z)();return(0,r.useEffect)((()=>{const r=n.Z.interceptors.request.use((s=>(s.headers.Authorization||(s.headers.Authorization="Bearer ".concat(null===e||void 0===e?void 0:e.accessToken)),s)),(e=>Promise.reject(e))),l=n.Z.interceptors.response.use((e=>e),(async e=>{var r,l;const o=null===e||void 0===e?void 0:e.config;if(403===(null===(r=e.response)||void 0===r?void 0:r.status)&&(null===o||void 0===o||!o.sent)){o.sent=!0;try{a.Z.log("Token expired, attempting refresh...");const e=(await c.Z.get("/refresh",{withCredentials:!0})).data.accessToken;return s((s=>(0,i.Z)((0,i.Z)({},s),{},{accessToken:e}))),localStorage.setItem("accessToken",e),o.headers.Authorization="Bearer ".concat(e),(0,n.Z)(o)}catch(d){a.Z.error("Token refresh failed:",d),t()}}return 401===(null===(l=e.response)||void 0===l?void 0:l.status)&&t(),Promise.reject(e)}));return()=>{n.Z.interceptors.request.eject(r),n.Z.interceptors.response.eject(l)}}),[e,s,t]),n.Z}},3940:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var i=t(1413),r=t(2791),n=t(7689),a=t(4391),l=t(6965),c=t(8421),o=t(184);const d=e=>{let{isVisible:s,onClose:t,progress:i=0,message:r="Processing..."}=e;return s?(0,o.jsx)("div",{className:"progress-modal-overlay",children:(0,o.jsxs)("div",{className:"progress-modal-content",children:[(0,o.jsxs)("div",{className:"progress-header",children:[(0,o.jsx)("h3",{children:"\ud83d\ude80 Importing District"}),(0,o.jsx)("p",{className:"progress-message",children:r})]}),(0,o.jsxs)("div",{className:"progress-container",children:[(0,o.jsx)("div",{className:"progress-bar-bg",children:(0,o.jsx)("div",{className:"progress-bar-fill",style:{width:"".concat(i,"%")}})}),(0,o.jsxs)("div",{className:"progress-text",children:[Math.round(i),"%"]})]}),(0,o.jsx)("div",{className:"progress-actions",children:(0,o.jsx)("button",{className:"cancel-btn",onClick:t,disabled:i>0&&i<100,children:i>=100?"Close":"Cancel"})})]})}):null},h=()=>{const{areaId:e}=(0,n.UO)(),s=(0,l.Z)(),[t,h]=(0,r.useState)(null),[p,u]=(0,r.useState)(""),[m,v]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null),[j,f]=(0,r.useState)(null),[b,y]=(0,r.useState)([]),[w,N]=(0,r.useState)(null),[S,C]=(0,r.useState)([]),[Z,k]=(0,r.useState)("create"),[E,T]=(0,r.useState)(!1),[I,D]=(0,r.useState)(0),[P,O]=(0,r.useState)("Starting import..."),F=(0,r.useCallback)((async()=>{try{const t=await s.get("/api/district/import-history/".concat(e));y(t.data.history||[])}catch(t){a.Z.error("Error fetching import history:",t),y([])}}),[s,e]);(0,r.useEffect)((()=>{F()}),[F]);const R=async t=>{a.Z.log("\ud83d\udd04 Generating preview for file:",t.name,t.type);try{const i=new FormData;i.append("file",t),i.append("areaId",e),a.Z.log("\ud83d\udce4 Sending preview request to /api/district/preview");const r=await s.post("/api/district/preview",i,{headers:{"Content-Type":"multipart/form-data"}});a.Z.log("\ud83d\udce5 Preview response received:",r.data),N(r.data),"update"===Z&&A(r.data)}catch(n){var r;a.Z.error("\u274c Error generating preview:",(null===(r=n.response)||void 0===r?void 0:r.data)||n.message),g((e=>{var s,t;return(0,i.Z)((0,i.Z)({},e),{},{errors:[...(null===e||void 0===e?void 0:e.errors)||[],"Failed to read file content: ".concat((null===(s=n.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||n.message)]})}))}},A=async t=>{try{const i=await s.post("/api/district/check-conflicts",{data:t,areaId:e});C(i.data.conflicts||[])}catch(i){a.Z.error("Error checking conflicts:",i)}};return(0,o.jsxs)("div",{className:"district-management-container",children:[(0,o.jsx)("h1",{children:"District Management"}),(0,o.jsxs)("div",{className:"operation-selector",children:[(0,o.jsx)("button",{className:"create"===Z?"active":"",onClick:()=>k("create"),children:"Create New District"}),(0,o.jsx)("button",{className:"update"===Z?"active":"",onClick:()=>k("update"),children:"Update Existing District"})]}),(0,o.jsx)(d,{isVisible:E,progress:I,message:P,onClose:()=>{(I>=100||P.includes("failed"))&&(T(!1),v(!1))}}),(0,o.jsxs)("div",{className:"main-content",children:[(0,o.jsxs)("div",{className:"upload-section",children:[(0,o.jsx)("h2",{children:"create"===Z?"\ud83d\udcc1 Create New District":"\ud83d\udd04 Update District Data"}),"create"===Z&&(0,o.jsxs)("div",{className:"district-name-input",children:[(0,o.jsx)("label",{htmlFor:"districtName",children:"District Name:"}),(0,o.jsx)("input",{id:"districtName",type:"text",value:p,onChange:e=>u(e.target.value),placeholder:"Enter district name...",disabled:m})]}),(0,o.jsxs)("div",{className:"file-input-section",children:[(0,o.jsx)("label",{htmlFor:"fileInput",children:"Select Excel File:"}),(0,o.jsx)("input",{id:"fileInput",type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{const s=e.target.files[0];if(!s)return h(null),void g(null);h(s);const t=(e=>{const s=[],t=[];return e.size>52428800&&s.push("File size exceeds 50MB limit"),["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(e.type)||s.push("File must be an Excel (.xlsx, .xls) or CSV file"),e.name.length>255&&t.push("File name is very long, consider shortening it"),{errors:s,warnings:t,isValid:0===s.length}})(s);g(t),t.isValid&&R(s)},disabled:m}),t&&(0,o.jsxs)("div",{className:"file-info",children:[(0,o.jsxs)("span",{children:["\ud83d\udcce ",t.name]}),(0,o.jsxs)("span",{children:["Size: ",(t.size/1024/1024).toFixed(2)," MB"]})]})]}),x?(0,o.jsxs)("div",{className:"validation-results",children:[x.errors.length>0&&(0,o.jsxs)("div",{className:"validation-errors",children:[(0,o.jsx)("h4",{children:"\u274c Errors (must be fixed):"}),(0,o.jsx)("ul",{children:x.errors.map(((e,s)=>(0,o.jsx)("li",{children:e},s)))})]}),x.warnings.length>0&&(0,o.jsxs)("div",{className:"validation-warnings",children:[(0,o.jsx)("h4",{children:"\u26a0\ufe0f Warnings:"}),(0,o.jsx)("ul",{children:x.warnings.map(((e,s)=>(0,o.jsx)("li",{children:e},s)))})]}),x.isValid&&(0,o.jsx)("div",{className:"validation-success",children:(0,o.jsx)("h4",{children:"\u2705 File validation passed"})})]}):null,(()=>{var e;if(!w)return null;a.Z.log("\ud83d\udd0d Rendering preview with data:",w);const s=w.stats||{},t=w.preview||[],i=w.buildingPreview||[],r=w.validation||{},n=s.totalBuildings||0,l=s.totalFlats||s.validRows||0,c=s.buildingsWithMultipleFlats||0;a.Z.log("\ud83d\udcca [Frontend] Accurate building statistics from backend:"),a.Z.log("\ud83c\udfe2 Total buildings: ".concat(n)),a.Z.log("\ud83c\udfe0 Total flats: ".concat(l)),a.Z.log("\ud83c\udfe2+ Buildings with multiple flats: ".concat(c)),a.Z.log("\ud83d\udcca Average flats per building: ".concat(n>0?Math.round(l/n):0)),i.length>0&&a.Z.log("\ud83c\udfe2 Sample buildings:",i.slice(0,5).map((e=>"".concat(e.buildingIdentifier," \u2192 ").concat(e.address," ").concat(e.houseNumber," (").concat(e.flatCount," flats)"))));const d=t.length>0?Object.keys(t[0]).filter((e=>!e.startsWith("_")&&"building"!==e&&"district"!==e)):[];return(0,o.jsxs)("div",{className:"data-preview",children:[(0,o.jsx)("h3",{children:"\ud83d\udcca Data Preview"}),(0,o.jsxs)("div",{className:"preview-stats",children:[(0,o.jsxs)("span",{children:["\ud83c\udfe2 Buildings: ",n]}),(0,o.jsxs)("span",{children:["\ud83c\udfe0 Apartments: ",l]}),(0,o.jsxs)("span",{children:["\ud83d\udccb Columns: ",(null===(e=r.stats)||void 0===e?void 0:e.columnsCount)||0]}),(0,o.jsxs)("span",{children:["\ud83c\udfe2+ Multi-unit: ",c]})]}),i.length>0&&(0,o.jsxs)("div",{className:"preview-table",children:[(0,o.jsx)("h4",{children:"\ud83c\udfe2 Building Preview (first 5 buildings):"}),(0,o.jsxs)("table",{children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Building ID"}),(0,o.jsx)("th",{children:"Address"}),(0,o.jsx)("th",{children:"Apartments"}),(0,o.jsx)("th",{children:"Sample Units"})]})}),(0,o.jsx)("tbody",{children:i.slice(0,5).map(((e,s)=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:e.buildingIdentifier})}),(0,o.jsxs)("td",{children:[e.address," ",e.houseNumber]}),(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:e.flatCount})}),(0,o.jsx)("td",{children:e.sampleFlats.map(((e,s)=>(0,o.jsx)("div",{style:{fontSize:"0.9em",color:"#666"},children:e.zoeksleutel},s)))})]},s)))})]})]}),t.length>0&&(0,o.jsxs)("div",{className:"preview-table",children:[(0,o.jsx)("h4",{children:"\ud83c\udfe0 Apartment Preview (first 5 rows):"}),(0,o.jsxs)("table",{children:[(0,o.jsx)("thead",{children:(0,o.jsx)("tr",{children:d.map(((e,s)=>(0,o.jsx)("th",{children:e},s)))})}),(0,o.jsx)("tbody",{children:t.slice(0,5).map(((e,s)=>(0,o.jsx)("tr",{children:d.map(((s,t)=>(0,o.jsx)("td",{children:e[s]||"-"},t)))},s)))})]})]}),r.warnings&&r.warnings.length>0&&(0,o.jsxs)("div",{className:"preview-warnings",children:[(0,o.jsx)("h4",{children:"\u26a0\ufe0f Warnings:"}),(0,o.jsx)("ul",{children:r.warnings.map(((e,s)=>(0,o.jsx)("li",{children:e},s)))})]})]})})(),0===S.length?null:(0,o.jsxs)("div",{className:"conflicts-section",children:[(0,o.jsx)("h3",{children:"\u26a0\ufe0f Data Conflicts Detected"}),(0,o.jsx)("p",{children:"The following apartments already exist and will be updated:"}),(0,o.jsx)("div",{className:"conflicts-list",children:S.map(((e,s)=>(0,o.jsxs)("div",{className:"conflict-item",children:[(0,o.jsx)("strong",{children:e.address}),(0,o.jsxs)("span",{children:["Changes: ",e.changedFields.join(", ")]})]},s)))})]}),(0,o.jsxs)("div",{className:"action-buttons",children:[(0,o.jsxs)("button",{onClick:async()=>{if(t&&null!==x&&void 0!==x&&x.isValid)if("create"!==Z||p.trim()){T(!0),D(0),O("Starting import..."),v(!0);try{const i=[{percent:10,message:"Uploading file..."},{percent:30,message:"Validating data..."},{percent:50,message:"Processing buildings..."},{percent:80,message:"Saving to database..."},{percent:100,message:"Import completed!"}];for(let e=0;e<i.length-1;e++)D(i[e].percent),O(i[e].message),await new Promise((e=>setTimeout(e,500)));const r=new FormData;r.append("file",t),r.append("areaId",e),r.append("operationType",Z),"create"===Z&&r.append("currentDistrict",p),a.Z.log("\ud83d\ude80 [Import] Starting enhanced import with progress tracking...");const n=await s.post("/api/district/import-enhanced",r,{headers:{"Content-Type":"multipart/form-data"}});D(100),O("Import completed successfully!"),a.Z.log("\u2705 [Import] Import completed:",n.data),setTimeout((()=>{h(null),u(""),g(null),N(null),T(!1),v(!1),F()}),2e3)}catch(n){var i,r;a.Z.error("\u274c [Import] Error during import:",n),O("Import failed: ".concat((null===(i=n.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.error)||n.message)),setTimeout((()=>{T(!1),v(!1)}),3e3)}}else alert("Please enter a district name")},disabled:!(null!==x&&void 0!==x&&x.isValid)||m||"create"===Z&&!p.trim(),className:"import-button",children:[m&&(0,o.jsx)(c.Z,{size:16,color:"#fff"}),"create"===Z?"Create District":"Update District"]}),(0,o.jsx)("button",{onClick:()=>{h(null),g(null),N(null),C([]),u("")},disabled:m,className:"reset-button",children:"Reset"})]}),j?(0,o.jsxs)("div",{className:"import-progress",children:[(0,o.jsxs)("div",{className:"progress-header",children:[(0,o.jsx)("h3",{children:j.message}),(0,o.jsxs)("span",{children:[j.progress,"%"]})]}),(0,o.jsx)("div",{className:"progress-bar",children:(0,o.jsx)("div",{className:"progress-fill",style:{width:"".concat(j.progress,"%"),backgroundColor:"error"===j.stage?"#dc3545":"#28a745"}})}),"error"===j.stage&&(0,o.jsx)("div",{className:"progress-error",children:(0,o.jsx)("p",{children:"Please check the file format and try again."})})]}):null]}),(0,o.jsxs)("div",{className:"sidebar",children:[Array.isArray(b)&&0!==b.length?(0,o.jsxs)("div",{className:"import-history",children:[(0,o.jsx)("h3",{children:"\ud83d\udccb Recent Imports"}),(0,o.jsx)("div",{className:"history-list",children:b.slice(0,5).map(((e,s)=>(0,o.jsxs)("div",{className:"history-item",children:[(0,o.jsxs)("div",{className:"history-info",children:[(0,o.jsx)("strong",{children:e.districtName}),(0,o.jsx)("span",{children:e.operation}),(0,o.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]}),(0,o.jsx)("div",{className:"history-status ".concat(e.status),children:e.status})]},s)))})]}):null,(0,o.jsxs)("div",{className:"help-section",children:[(0,o.jsx)("h3",{children:"\ud83d\udca1 Help"}),(0,o.jsxs)("div",{className:"help-content",children:[(0,o.jsx)("h4",{children:"File Requirements:"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"Excel (.xlsx, .xls) or CSV format"}),(0,o.jsx)("li",{children:"Maximum size: 50MB"}),(0,o.jsx)("li",{children:"Required columns: Opdrachtnummer, Volledig adres, etc."})]}),(0,o.jsx)("h4",{children:"Weekly Update Process:"}),(0,o.jsxs)("ol",{children:[(0,o.jsx)("li",{children:"Receive Excel file on Sunday"}),(0,o.jsx)("li",{children:'Use "Update District" mode'}),(0,o.jsx)("li",{children:"Review conflicts before proceeding"}),(0,o.jsx)("li",{children:"Check import history for verification"})]})]})]})]})]})]})}},8421:(e,s,t)=>{t.d(s,{Z:()=>o});var i=t(2791),r={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function n(e){var s=function(e){if("number"===typeof e)return{value:e,unit:"px"};var s,t=(e.match(/^[0-9.]*/)||"").toString();s=t.includes(".")?parseFloat(t):parseInt(t,10);var i=(e.match(/[^0-9]*$/)||"").toString();return r[i]?{value:s,unit:i}:(console.warn("React Spinners: ".concat(e," is not a valid css value. Defaulting to ").concat(s,"px.")),{value:s,unit:"px"})}(e);return"".concat(s.value).concat(s.unit)}var a=function(){return a=Object.assign||function(e){for(var s,t=1,i=arguments.length;t<i;t++)for(var r in s=arguments[t])Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);return e},a.apply(this,arguments)},l=function(e,s){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&s.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)s.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(t[i[r]]=e[i[r]])}return t},c=function(e,s,t){var i="react-spinners-".concat(e,"-").concat(t);if("undefined"==typeof window||!window.document)return i;var r=document.createElement("style");document.head.appendChild(r);var n=r.sheet,a="\n    @keyframes ".concat(i," {\n      ").concat(s,"\n    }\n  ");return n&&n.insertRule(a,0),i}("BounceLoader","0% {transform: scale(0)} 50% {transform: scale(1.0)} 100% {transform: scale(0)}","bounce");const o=function(e){var s=e.loading,t=void 0===s||s,r=e.color,o=void 0===r?"#000000":r,d=e.speedMultiplier,h=void 0===d?1:d,p=e.cssOverride,u=void 0===p?{}:p,m=e.size,v=void 0===m?60:m,x=l(e,["loading","color","speedMultiplier","cssOverride","size"]),g=function(e){var s=1===e?"".concat(1/h,"s"):"0s";return{position:"absolute",height:n(v),width:n(v),backgroundColor:o,borderRadius:"100%",opacity:.6,top:0,left:0,animationFillMode:"both",animation:"".concat(c," ").concat(2.1/h,"s ").concat(s," infinite ease-in-out")}},j=a({display:"inherit",position:"relative",width:n(v),height:n(v)},u);return t?i.createElement("span",a({style:j},x),i.createElement("span",{style:g(1)}),i.createElement("span",{style:g(2)})):null}}}]);
//# sourceMappingURL=940.77b66b9f.chunk.js.map