"use strict";(self.webpackChunkdynet=self.webpackChunkdynet||[]).push([[318],{4677:(e,t,n)=>{n.d(t,{Z:()=>c,y:()=>i});var a=n(3263);const s={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL||"https://backend-dynet2-1.onrender.com",i=a.Z.create({baseURL:s,headers:{"Content-Type":"application/json"},withCredentials:!0}),r=a.Z.create({baseURL:s,headers:{"Content-Type":"application/json"},withCredentials:!0});r.interceptors.response.use((e=>e),(async e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("accessToken"),localStorage.removeItem("roles"),window.location.href="/login"),Promise.reject(e)}));const c=r},6965:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(1413),s=n(2791),i=n(4677),r=n(4391),c=n(7834),o=n(3263);const l=()=>{const{auth:e,setAuth:t,logout:n}=(0,c.Z)();return(0,s.useEffect)((()=>{const s=i.Z.interceptors.request.use((t=>(t.headers.Authorization||(t.headers.Authorization="Bearer ".concat(null===e||void 0===e?void 0:e.accessToken)),t)),(e=>Promise.reject(e))),c=i.Z.interceptors.response.use((e=>e),(async e=>{var s,c;const l=null===e||void 0===e?void 0:e.config;if(403===(null===(s=e.response)||void 0===s?void 0:s.status)&&(null===l||void 0===l||!l.sent)){l.sent=!0;try{r.Z.log("Token expired, attempting refresh...");const e=(await o.Z.get("/refresh",{withCredentials:!0})).data.accessToken;return t((t=>(0,a.Z)((0,a.Z)({},t),{},{accessToken:e}))),localStorage.setItem("accessToken",e),l.headers.Authorization="Bearer ".concat(e),(0,i.Z)(l)}catch(d){r.Z.error("Token refresh failed:",d),n()}}return 401===(null===(c=e.response)||void 0===c?void 0:c.status)&&n(),Promise.reject(e)}));return()=>{i.Z.interceptors.request.eject(s),i.Z.interceptors.response.eject(c)}}),[e,t,n]),i.Z}},7318:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var a=n(2791),s=n(7689),i=n(1087),r=n(4391),c=n(6965),o=n(7834),l=n(1413),d=n(184);const m=e=>{let{apartments:t,selectedApartments:n,flatAppointments:a,isHASScheduling:s,onApartmentSelect:i,isSingleApartment:r}=e;const c=e=>e.adres?"".concat(e.adres," ").concat(e.huisNummer||"").concat(e.toevoeging||""):e.flatNumber||e.name||"Apartment ".concat(e._id.slice(-4));if(r&&1===t.length){const e=t[0],n=a[e._id];return(0,d.jsxs)("div",{className:"usc-singleApartment",children:[(0,d.jsxs)("h3",{children:["Scheduling for: ",c(e)]}),n&&(0,d.jsxs)("div",{className:"usc-currentAppointment",children:[(0,d.jsx)("h4",{children:"Current Appointment:"}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Date:"})," ",new Date(n.date).toLocaleDateString()]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Time:"})," ",n.startTime," - ",n.endTime]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Week:"})," ",n.weekNumber]}),s&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Type:"})," ",n.type]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"HAS Monteur:"})," ",n.hasMonteurName]})]}),!s&&(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Technische Schouwer:"})," ",n.technischeSchouwerName]})]})]})}return(0,d.jsxs)("div",{className:"usc-apartmentList",children:[(0,d.jsxs)("h3",{children:["Select Apartments for ",s?"HAS":"Technical Planning"," Appointment"]}),t.map((e=>{const t=n.includes(e._id),r=a[e._id];return(0,d.jsxs)("div",{className:"usc-apartmentItem",children:[(0,d.jsxs)("label",{className:"usc-apartmentLabel",children:[(0,d.jsx)("input",{type:"checkbox",checked:t,onChange:()=>i(e._id),className:"usc-checkbox"}),(0,d.jsxs)("span",{className:"usc-apartmentAddress",children:[c(e),r&&(0,d.jsx)("span",{className:"usc-hasAppointmentIndicator",children:" (Has existing appointment)"})]})]}),r&&(0,d.jsxs)("div",{className:"usc-existingAppointmentDetails",children:[(0,d.jsxs)("p",{children:["Date: ",new Date(r.date).toLocaleDateString()]}),(0,d.jsxs)("p",{children:["Time: ",r.startTime," - ",r.endTime]}),(0,d.jsxs)("p",{children:["Week: ",r.weekNumber]}),s&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("p",{children:["Type: ",r.type]}),(0,d.jsxs)("p",{children:["HAS Monteur: ",r.hasMonteurName]})]}),!s&&(0,d.jsxs)("p",{children:["Technische Schouwer: ",r.technischeSchouwerName]})]})]},e._id)}))]})};m.defaultProps={flatAppointments:{},isSingleApartment:!1};const u=m,h=e=>{let{appointmentData:t,onAppointmentChange:n,onSubmit:a,onCancel:s,availablePersonnel:i,isHASScheduling:r,loading:c,canSubmit:o}=e;return(0,d.jsxs)("div",{className:"usc-appointmentForm",children:[(0,d.jsxs)("h3",{children:["Set ",r?"HAS":"Technical Planning"," Appointment Details"]}),(0,d.jsxs)("form",{onSubmit:a,children:[r&&(0,d.jsxs)("div",{className:"usc-formGroup",children:[(0,d.jsx)("label",{children:"Appointment Type:"}),(0,d.jsx)("div",{className:"usc-radioGroup",children:["HAS","Storing","Complaint"].map((e=>(0,d.jsxs)("label",{className:"usc-radioLabel",children:[(0,d.jsx)("input",{type:"radio",name:"type",value:e,checked:t.type===e,onChange:n}),e]},e)))})]}),r&&"Complaint"===t.type&&(0,d.jsxs)("div",{className:"usc-formGroup",children:[(0,d.jsx)("label",{children:"Complaint Details:"}),(0,d.jsx)("textarea",{name:"complaintDetails",value:t.complaintDetails,onChange:n,className:"usc-textarea",rows:"4",placeholder:"Enter complaint details",required:"Complaint"===t.type})]}),(0,d.jsxs)("div",{className:"usc-formGroup",children:[(0,d.jsx)("label",{children:"Appointment Date:"}),(0,d.jsx)("input",{type:"date",name:"date",value:t.date,onChange:n,className:"usc-input",required:!0})]}),(0,d.jsxs)("div",{className:"usc-formRow",children:[(0,d.jsxs)("div",{className:"usc-formGroup",children:[(0,d.jsx)("label",{children:"Start Time:"}),(0,d.jsx)("input",{type:"time",name:"startTime",value:t.startTime,onChange:n,className:"usc-input",required:!0})]}),(0,d.jsxs)("div",{className:"usc-formGroup",children:[(0,d.jsx)("label",{children:"End Time:"}),(0,d.jsx)("input",{type:"time",name:"endTime",value:t.endTime,onChange:n,className:"usc-input",required:!0})]})]}),(0,d.jsxs)("div",{className:"usc-formGroup",children:[(0,d.jsx)("label",{children:"Week Number:"}),(0,d.jsx)("input",{type:"number",name:"weekNumber",value:t.weekNumber||"",readOnly:!0,className:"usc-input usc-readonly"})]}),(0,d.jsxs)("div",{className:"usc-formGroup",children:[(0,d.jsx)("label",{children:r?"HAS Monteur:":"Technische Schouwer:"}),(0,d.jsxs)("select",{name:r?"hasMonteurName":"technischeSchouwerName",value:r?t.hasMonteurName:t.technischeSchouwerName,onChange:n,className:"usc-select",required:!0,children:[(0,d.jsxs)("option",{value:"",children:["Select a ",r?"HAS Monteur":"Technische Schouwer"]}),i.map((e=>(0,d.jsx)("option",{value:e.name,children:e.name},e._id)))]})]}),(0,d.jsxs)("div",{className:"usc-buttonGroup",children:[(0,d.jsx)("button",{type:"submit",className:"usc-saveButton",disabled:c||!o,children:c?"Saving...":"Save Appointment"}),s&&(0,d.jsx)("button",{type:"button",onClick:s,className:"usc-cancelButton",disabled:c,children:"Cancel"})]})]})]})};h.defaultProps={availablePersonnel:[],isHASScheduling:!1,loading:!1,canSubmit:!0};const p=h,v=e=>{let{apartments:t=[],scheduleType:n,onSaveSuccess:s,onCancel:i,preselectedApartments:o=[]}=e;const m=(0,c.Z)(),[h,v]=(0,a.useState)(!1),g=e=>{const t=new Date(e),n=new Date(t.getFullYear(),0,1),a=Math.floor((t-n)/864e5);return Math.ceil((t.getDay()+1+a)/7)},[S,N]=(0,a.useState)(o),[x,T]=(0,a.useState)((()=>{const e=(new Date).toISOString().split("T")[0];return{date:e,startTime:"",endTime:"",weekNumber:g(e),type:"HAS"===n?"HAS":"Technical",hasMonteurName:"",technischeSchouwerName:"",complaintDetails:""}})),[j,f]=(0,a.useState)([]),[w,y]=(0,a.useState)({}),A="HAS"===n,b=1===t.length,k=e=>{if(!e)return"";return new Date(e).toISOString().split("T")[0]};(0,a.useEffect)((()=>{if(D(),C(),b)N([t[0]._id]),M();else{const i=t.filter((e=>{var t,n;const a=A?null===(t=e.hasMonteur)||void 0===t?void 0:t.appointmentBooked:null===(n=e.technischePlanning)||void 0===n?void 0:n.appointmentBooked;return null===a||void 0===a?void 0:a.date})).map((e=>e._id)),r=[...new Set([...o,...i])];if(N(r),1===r.length){const i=t.find((e=>e._id===r[0]));if(i){var e,n;const t=A?null===(e=i.hasMonteur)||void 0===e?void 0:e.appointmentBooked:null===(n=i.technischePlanning)||void 0===n?void 0:n.appointmentBooked;var a,s;if(null!==t&&void 0!==t&&t.date)T({date:k(t.date),startTime:t.startTime||"",endTime:t.endTime||"",weekNumber:t.weekNumber||g(t.date),type:t.type||(A?"HAS":"Technical"),hasMonteurName:A&&(null===(a=i.hasMonteur)||void 0===a?void 0:a.hasMonteurName)||"",technischeSchouwerName:A?"":(null===(s=i.technischePlanning)||void 0===s?void 0:s.technischeSchouwerName)||"",complaintDetails:t.complaintDetails||""})}}}}),[t,n,o,A]);const D=async()=>{try{const e=(await m.get("/api/users")).data;let t=[];t=A?e.filter((e=>e.roles&&"object"===typeof e.roles&&2023===e.roles.HASMonteur)):e.filter((e=>e.roles&&"object"===typeof e.roles&&8687===e.roles.TechnischeSchouwer)),f(t)}catch(e){r.Z.error("Error fetching personnel:",e)}},C=()=>{const e={};t.forEach((t=>{var n,a;const s=A?null===(n=t.hasMonteur)||void 0===n?void 0:n.appointmentBooked:null===(a=t.technischePlanning)||void 0===a?void 0:a.appointmentBooked;var i,r;null!==s&&void 0!==s&&s.date&&(e[t._id]={date:k(s.date),startTime:s.startTime,endTime:s.endTime,weekNumber:s.weekNumber,type:s.type||(A?"HAS":"Technical"),hasMonteurName:A&&(null===(i=t.hasMonteur)||void 0===i?void 0:i.hasMonteurName)||"",technischeSchouwerName:A?"":(null===(r=t.technischePlanning)||void 0===r?void 0:r.technischeSchouwerName)||"",complaintDetails:s.complaintDetails||""})})),y(e)},M=()=>{var e,n;if(1!==t.length)return;const a=t[0],s=A?null===(e=a.hasMonteur)||void 0===e?void 0:e.appointmentBooked:null===(n=a.technischePlanning)||void 0===n?void 0:n.appointmentBooked;if(s&&s.date){var i,r;T({date:k(s.date),startTime:s.startTime||"",endTime:s.endTime||"",weekNumber:s.weekNumber||g(s.date),type:s.type||(A?"HAS":"Technical"),hasMonteurName:A&&(null===(i=a.hasMonteur)||void 0===i?void 0:i.hasMonteurName)||"",technischeSchouwerName:A?"":(null===(r=a.technischePlanning)||void 0===r?void 0:r.technischeSchouwerName)||"",complaintDetails:s.complaintDetails||""})}else{var c,o;const e=(new Date).toISOString().split("T")[0];T({date:e,startTime:"",endTime:"",weekNumber:g(e),type:A?"HAS":"Technical",hasMonteurName:A&&(null===(c=a.hasMonteur)||void 0===c?void 0:c.hasMonteurName)||"",technischeSchouwerName:A?"":(null===(o=a.technischePlanning)||void 0===o?void 0:o.technischeSchouwerName)||"",complaintDetails:""})}};return(0,d.jsx)("div",{className:"usc-container",children:(0,d.jsxs)("div",{className:"usc-columns",children:[(0,d.jsx)("div",{className:"usc-leftColumn",children:(0,d.jsx)(u,{apartments:t,selectedApartments:S,flatAppointments:w,isHASScheduling:A,onApartmentSelect:e=>{if(b)return;const t=S.includes(e)?S.filter((t=>t!==e)):[...S,e];if(N(t),1===t.length&&w[e]){const t=w[e];T({date:t.date,startTime:t.startTime,endTime:t.endTime,weekNumber:t.weekNumber,type:t.type,hasMonteurName:t.hasMonteurName,technischeSchouwerName:t.technischeSchouwerName,complaintDetails:t.complaintDetails})}else if(1!==t.length){const e=(new Date).toISOString().split("T")[0];T({date:e,startTime:"",endTime:"",weekNumber:g(e),type:A?"HAS":"Technical",hasMonteurName:"",technischeSchouwerName:"",complaintDetails:""})}},isSingleApartment:b})}),(0,d.jsx)("div",{className:"usc-rightColumn",children:(0,d.jsx)(p,{appointmentData:x,onAppointmentChange:e=>{const{name:t,value:n}=e.target;T((e=>(0,l.Z)((0,l.Z)({},e),{},{[t]:n},"date"===t?{weekNumber:g(n)}:{})))},onSubmit:async e=>{if(e.preventDefault(),0!==S.length){v(!0);try{const e=await Promise.all(S.map((async e=>{const t=A?{appointmentBooked:{date:x.date,startTime:x.startTime,endTime:x.endTime,weekNumber:x.weekNumber,type:x.type},hasMonteurName:x.hasMonteurName}:{appointmentBooked:{date:x.date,startTime:x.startTime,endTime:x.endTime,weekNumber:x.weekNumber},technischeSchouwerName:x.technischeSchouwerName};A&&"Complaint"===x.type&&x.complaintDetails&&(t.appointmentBooked.complaintDetails=x.complaintDetails);const n="/api/apartment/".concat(e,A?"/has-monteur":"/technische-planning");return{apartmentId:e,data:(await m.put(n,t)).data}}))),t=(0,l.Z)({},w);e.forEach((e=>{var n,a;let{apartmentId:s,data:i}=e;const r=A?null===(n=i.hasMonteur)||void 0===n?void 0:n.appointmentBooked:null===(a=i.technischePlanning)||void 0===a?void 0:a.appointmentBooked;var c,o;r&&(t[s]={date:k(r.date),startTime:r.startTime,endTime:r.endTime,weekNumber:r.weekNumber,type:r.type||(A?"HAS":"Technical"),hasMonteurName:A&&(null===(c=i.hasMonteur)||void 0===c?void 0:c.hasMonteurName)||"",technischeSchouwerName:A?"":(null===(o=i.technischePlanning)||void 0===o?void 0:o.technischeSchouwerName)||"",complaintDetails:r.complaintDetails||""})})),y(t),s&&s(e),alert("".concat(A?"HAS":"Technical Planning"," appointments saved successfully!"))}catch(t){r.Z.error("Error saving appointments:",t),alert("Error saving appointments. Please try again.")}finally{v(!1)}}else alert("Please select at least one apartment.")},onCancel:i,availablePersonnel:j,isHASScheduling:A,loading:h,canSubmit:S.length>0})})]})})};var g=n(3585);const S=()=>{const{id:e}=(0,s.UO)(),t=(0,s.s0)(),[n]=(0,i.lr)(),l=(0,c.Z)(),{auth:m}=(0,o.Z)(),[u,h]=(0,a.useState)(!0),[p,S]=(0,a.useState)([]),[N,x]=(0,a.useState)(""),[T,j]=(0,a.useState)(""),f=n.get("mode")||"single",w=n.get("type")||"";(0,a.useEffect)((()=>{y()}),[e,f,w,m]);const y=async()=>{h(!0);try{let t=w;var e,n;if(!t)if(null!==m&&void 0!==m&&null!==(e=m.roles)&&void 0!==e&&e.includes(g.K$.HAS_PLANNING))t="HAS";else{if(null===m||void 0===m||null===(n=m.roles)||void 0===n||!n.includes(g.K$.TECHNICAL_PLANNING))throw new Error("User does not have permission to schedule appointments");t="Technical"}x(t),"building"===f?await A(t):await b(t)}catch(a){r.Z.error("Error determining schedule type or fetching data:",a),alert("Error loading appointment data. Please try again."),t(-1)}finally{h(!1)}},A=async t=>{try{const n=(await l.get("/api/building/".concat(e))).data;S(n.flats||[]),j("".concat(t," Appointment Scheduling - ").concat(n.address||"Building"))}catch(n){throw r.Z.error("Error fetching building data:",n),n}},b=async t=>{try{const n=(await l.get("/api/apartment/".concat(e))).data;S([n]),j("".concat(t," Appointment Scheduling - ").concat(n.adres," ").concat(n.huisNummer).concat(n.toevoeging))}catch(n){throw r.Z.error("Error fetching apartment data:",n),n}};if(u)return(0,d.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",fontSize:"18px",color:"#666"},children:"Loading appointment data..."});if(!p.length)return(0,d.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",fontSize:"18px",color:"#666"},children:"No apartments found for scheduling."});const k="single"===f?[p[0]._id]:[];return(0,d.jsxs)("div",{style:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},children:[(0,d.jsxs)("div",{style:{marginBottom:"30px",textAlign:"center"},children:[(0,d.jsx)("h1",{style:{color:"#2c3e50",marginBottom:"10px",fontSize:"2rem",fontWeight:"600"},children:T}),(0,d.jsx)("div",{style:{color:"#7f8c8d",fontSize:"1rem",fontWeight:"500"},children:"building"===f?"Select apartments and set appointment details for ".concat(N," scheduling"):"Set appointment details for this apartment"})]}),(0,d.jsx)(v,{apartments:p,scheduleType:N,onSaveSuccess:e=>{if("single"===f){const e=p[0].apartmentId;t("HAS"===N?"/has-planning-apartment/".concat(e):"/planning-apartment/".concat(e))}},onCancel:()=>{t(-1)},preselectedApartments:k})]})}}}]);
//# sourceMappingURL=318.a900fe32.chunk.js.map